{% extends 'base.html' %}
{% load django_bootstrap5 %}
{% load static %}
{% block content %}

<div class='text-center m-3'>
    <h1 class="mb-4">DETAIL페이지</h1>
  
    <p>리뷰 제목 : {{ review.title }}</p>
    <p>리뷰내용 :
      {{ review.content }}</p>
    {% if request.user == review.user %}
        <p>
          <a href="{% url 'articles:update' review.pk %}" class="btn btn-outline-dark">수정</a>
        </p>
      <form action="{% url 'articles:delete' review.pk %}" method="POST">
        {% csrf_token %}
        <input type="submit" class="btn btn-outline-danger mx-2" value="삭제">
      </form>
      {% endif %}
   
    <p>생성일 : {{ review.created_at }}</p>
    <p>작성자 : <a class="text-decoration-none"  href={% url 'accounts:detail' review.user.pk %}>{{review.user}}</a></p>
   

    {% if review.image %}
      <img src="{{ review.image.url }}" alt="{{ review.image }}" width="400" height="300">
    {% endif %}
</div>
<hr>
<div class="p-4">
<form class='like-form' data-review-pk='{{ review.pk }}'>
  {% csrf_token %}
  <span class='like-cnt'>{{review.like_users.count}}</span>
  {% if request.user in review.like_users.all %}
    <button class="btn btn-link text-danger">
      <i class="bi bi-heart-fill heart-icon"></i>
    </button>
  {% else %}
    <button class="btn btn-link text-danger">
      <i class="bi bi-heart heart-icon"></i>
    </button>
  {% endif %}

</form>
{% if request.user.is_authenticated %}
  <form action="{% url 'articles:comment_create' review.pk %}" method="POST">
    {% csrf_token %}
    {% bootstrap_form comment_form %}
    <input class="bnt my-3"  type="submit" value="OK">
  </form>
{% endif %}
<hr>
{% if comments %}
<p>
  <b>{{ comments|length }}개의 댓글이 있습니다.</b>
</p>
{% endif %}
<br>

{% for comment in comments %}
<article class='comment-block-{{ comment.pk }}'>
 
  <div class="p-3 mb-4" style="border-radius: 1rem; box-shadow: 2px 3px 7px">
  <p class='comment-{{ comment.pk }}-content-container'>
    {{ comment.user.username }}
    |
      <span class='comment-{{ comment.pk }}-content'>{{ comment.content }}</span>
  </p>
  <div class="d-flex">
    {% if request.user == review.user %}
    <a href="{% url 'articles:comment_update' review.pk comment.pk %}" class="btn btn-outline-dark comment-update-btn" data-review-pk='{{ review.pk }}' data-comment-pk='{{ comment.pk }}'>수정</a>
    <form action="{% url 'articles:comment_delete' review.pk comment.pk %}" method="POST" class="my-0">
      {% csrf_token %}
      <input type="submit" class="btn btn-outline-danger mx-2" value="삭제">
    </form>
  </div>
  {% endif %}
</div></a>
</article>
<hr>
{% empty %}
  <p>아직 아무도 못본거라고 믿자,,</p>
{% endfor %}
<a href="{% url 'articles:index' %}" class="text-decoration-none" >back</a>
{% endblock %}
</div>

{% block js %}
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="{% static 'js/articles/detail.js' %}"></script>
  {% endblock js %}